"use strict";!function(){function e(e,t){for(;(e=e.parentElement)&&!e.classList.contains(t););return e}function t(){return!!("ontouchstart"in window||window.navigator&&window.navigator.msPointerEnabled&&window.MSGesture||window.DocumentTouch&&document instanceof DocumentTouch)}var n={init:function(){this.CONTAINERS=document.getElementsByClassName("walnut"),this.containerArray=[],this.viewer={},this.config={},this.touchStart=0,this.touchEnd=0;var e,a,i,r;e=document.getElementById("walnutScript").src,e=e.replace("walnut.js",""),a=e.split("/"),i="";for(var r=3;r<a.length;r++)3!==r&&(i+="/"),i+=a[r];n.config.path=i,this.indexImages(),this.buildTemplate(),this.addCSSLink(),t()&&n.viewer.wrapper.classList.add("walnut--is-touch")},initEvents:function(){n.viewer.wrapper.addEventListener("click",n.clickWrapper),n.viewer.closeBtn.addEventListener("click",n.closeViewer),n.viewer.nextBtn.addEventListener("click",n.nextImage),n.viewer.prevBtn.addEventListener("click",n.prevImage),document.addEventListener("keyup",n.checkKeyPressed),n.viewer.mainImage.addEventListener("touchstart",n.swipeStart),n.viewer.mainImage.addEventListener("touchend",n.swipeEnd)},deinitEvents:function(){n.viewer.wrapper.removeEventListener("click",n.clickWrapper),n.viewer.closeBtn.removeEventListener("click",n.closeViewer),n.viewer.nextBtn.removeEventListener("click",n.nextImage),n.viewer.prevBtn.removeEventListener("click",n.prevImage),document.removeEventListener("keyup",n.checkKeyPressed)},addCSSLink:function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",n.config.path+"styles/walnut.css"),document.getElementsByTagName("head")[0].appendChild(e)},indexImages:function(){for(var e=0;e<this.CONTAINERS.length;e++){this.containerArray.push({container:this.CONTAINERS[e],images:[]}),this.CONTAINERS[e].setAttribute("data-walnut-container",e);var t=this.CONTAINERS[e].getElementsByTagName("img"),a=this.CONTAINERS[e].getElementsByClassName("walnut-image"),i=[];if(a)for(var r=0;r<a.length;r++)i.push(a[r]);if(t)for(var r=0;r<t.length;r++)i.push(t[r]);for(var s=0;s<i.length;s++){i[s].addEventListener("click",n.openViewer),i[s].setAttribute("data-walnut-index",s);var c;if(i[s].src)c=i[s].src;else{var l=i[s].currentStyle||window.getComputedStyle(i[s],!1);c=l.backgroundImage.slice(4,-1).replace(/"/g,"")}this.containerArray[e].images.push({elem:i[s],src:c,index:s})}}},buildTemplate:function(){var e=document.createElement("ul"),t=document.createElement("div"),a=document.createElement("div"),i=document.createElement("div"),r=document.createElement("img"),s=document.createElement("div"),c=document.createElement("div"),l=document.createElement("img"),o=document.createElement("div"),d=document.createElement("img"),u=document.createElement("img"),m=document.getElementsByTagName("body")[0];e.className="walnut__list",t.className="walnut__list-container",r.className="walnut__image",s.className="walnut__image-container",i.className="walnut__box",a.className="walnut__wrapper",u.className="walnut__close",u.src=n.config.path+"images/button_close.svg",c.className="walnut__navigation walnut__navigation--next",l.src=n.config.path+"images/button_to_right.svg",l.className="walnut__navigation-img",o.className="walnut__navigation walnut__navigation--prev",d.src=n.config.path+"images/button_to_left.svg",d.className="walnut__navigation-img",c.appendChild(l),o.appendChild(d),s.appendChild(r),s.appendChild(c),s.appendChild(o),t.appendChild(e),i.appendChild(s),i.appendChild(t),i.appendChild(u),a.appendChild(i),m.appendChild(a),n.body=m,n.viewer.closeBtn=u,n.viewer.nextBtn=c,n.viewer.prevBtn=o,n.viewer.mainImage=r,n.viewer.wrapper=a,n.viewer.list=e},setImages:function(e){var t;if(n.viewer.list.innerHTML="",this.containerArray[n.containerIndex].images.length>1){for(var a=0;a<this.containerArray[n.containerIndex].images.length;a++)t=document.createElement("li"),t.className="walnut__item",t.style.backgroundImage="url("+n.containerArray[n.containerIndex].images[a].src+")",t.setAttribute("data-walnut-source",n.containerArray[n.containerIndex].images[a].src),t.setAttribute("data-walnut-index",n.containerArray[n.containerIndex].images[a].index),t.addEventListener("click",function(){var e=this.getAttribute("data-walnut-source");n.changeImage(null,{source:e,index:this.getAttribute("data-walnut-index"),container:null})}),n.viewer.list.appendChild(t);document.getElementsByClassName("walnut__list")[0].style.width=200*this.containerArray[n.containerIndex].images.length+"px"}},openViewer:function(t){var a,i;i=e(t.target,"walnut"),i&&(n.containerIndex=i.getAttribute("data-walnut-container")),n.setImages(),a=this.getAttribute("data-walnut-index"),a=parseInt(a);var r;if(this.src)r=this.src;else{var s=this.currentStyle||window.getComputedStyle(this,!1);r=s.backgroundImage.slice(4,-1).replace(/"/g,"")}n.viewer.mainImage.src=r,n.viewer.mainImage.setAttribute("data-walnut-index",a),n.viewer.wrapper.classList.add("walnut__wrapper--open"),n.body.classList.add("walnut--open"),0===a&&a===n.containerArray[n.containerIndex].images.length-1?(n.viewer.prevBtn.style.display="none",n.viewer.nextBtn.style.display="none"):0===a?(n.viewer.prevBtn.style.display="none",n.viewer.nextBtn.style.display=""):a===n.containerArray[n.containerIndex].images.length-1?(n.viewer.nextBtn.style.display="none",n.viewer.prevBtn.style.display=""):(n.viewer.prevBtn.style.display="",n.viewer.nextBtn.style.display=""),n.initEvents()},closeViewer:function(){n.viewer.mainImage.src="",n.viewer.wrapper.classList.remove("walnut__wrapper--open"),n.body.classList.remove("walnut--open"),n.deinitEvents()},changeImage:function(e,t){var a=0;if("undefined"!=typeof e&&null!==e){if(a=n.viewer.mainImage.getAttribute("data-walnut-index"),a=parseInt(a),"next"===e&&a<n.containerArray[n.containerIndex].images.length-1)a+=1;else{if(!("prev"===e&&a>0))return;a-=1}n.containerArray[n.containerIndex].images[a]&&(n.viewer.mainImage.src=n.containerArray[n.containerIndex].images[a].src,n.viewer.mainImage.setAttribute("data-walnut-index",a))}else"undefined"!=typeof t&&(a=parseInt(t.index),n.viewer.mainImage.src=t.source,n.viewer.mainImage.setAttribute("data-walnut-index",a));0===a&&a===n.containerArray[n.containerIndex].images.length-1?(n.viewer.prevBtn.style.display="none",n.viewer.nextBtn.style.display="none"):0===a?(n.viewer.prevBtn.style.display="none",n.viewer.nextBtn.style.display=""):a===n.containerArray[n.containerIndex].images.length-1?(n.viewer.nextBtn.style.display="none",n.viewer.prevBtn.style.display=""):(n.viewer.prevBtn.style.display="",n.viewer.nextBtn.style.display="")},checkKeyPressed:function(e){var t=e.keyCode;37===t?n.changeImage("prev"):39===t?n.changeImage("next"):27===t&&n.closeViewer()},clickWrapper:function(e){e.stopPropagation(),e.preventDefault(),e.target===this&&n.closeViewer.call(this)},nextImage:function(){n.changeImage.call(this,"next")},prevImage:function(){n.changeImage.call(this,"prev")},swipeStart:function(e){var t=e.changedTouches[0];n.touchStart=parseInt(t.clientX),e.preventDefault()},swipeEnd:function(e){var t=e.changedTouches[0];n.touchEnd=parseInt(t.clientX),e.preventDefault(),n.touchStart>n.touchEnd?n.nextImage():n.touchStart<n.touchEnd&&n.prevImage()}};n.init()}();