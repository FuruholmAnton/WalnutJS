"use strict";!function(){function e(e,t){for(;(e=e.parentElement)&&!e.classList.contains(t););return e}function t(){return!!("ontouchstart"in window||window.navigator&&window.navigator.msPointerEnabled&&window.MSGesture||window.DocumentTouch&&document instanceof DocumentTouch)}window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var i={init:function(){this.CONTAINERS=document.getElementsByClassName("walnut"),this.containerArray=[],this.viewer={},this.config={},this.touchStart=0,this.touchEnd=0,this.allowedTouchDistance=100,sessionStorage.countTouch=0;var e,n,a,r;e=document.getElementById("walnutScript").src,e=e.replace("walnut.js",""),n=e.split("/"),a="";for(var r=3;r<n.length;r++)3!==r&&(a+="/"),a+=n[r];i.config.path=a,this.indexImages(),this.buildTemplate(),this.addCSSLink(),t()&&i.viewer.wrapper.classList.add("walnut--is-touch")},initEvents:function(){i.viewer.wrapper.addEventListener("click",i.clickWrapper),i.viewer.closeBtn.addEventListener("click",i.closeViewer),document.addEventListener("keyup",i.checkKeyPressed),t()?(i.viewer.mainImage.addEventListener("touchstart",i.swipeStart),i.viewer.mainImage.addEventListener("touchend",i.swipeEnd),i.viewer.mainImage.addEventListener("touchmove",i.swipeMove)):(i.viewer.nextBtn.addEventListener("click",i.nextImage),i.viewer.prevBtn.addEventListener("click",i.prevImage))},deinitEvents:function(){i.viewer.wrapper.removeEventListener("click",i.clickWrapper),i.viewer.closeBtn.removeEventListener("click",i.closeViewer),document.removeEventListener("keyup",i.checkKeyPressed),t()?(i.viewer.mainImage.removeEventListener("touchstart",i.swipeStart),i.viewer.mainImage.removeEventListener("touchend",i.swipeEnd),i.viewer.mainImage.removeEventListener("touchmove",i.swipeMove)):(i.viewer.nextBtn.removeEventListener("click",i.nextImage),i.viewer.prevBtn.removeEventListener("click",i.prevImage))},addCSSLink:function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",i.config.path+"styles/walnut.css"),document.getElementsByTagName("head")[0].appendChild(e)},indexImages:function(){for(var e=0;e<this.CONTAINERS.length;e++){this.containerArray.push({container:this.CONTAINERS[e],images:[]}),this.CONTAINERS[e].setAttribute("data-walnut-container",e);var t=this.CONTAINERS[e].getElementsByTagName("img"),n=this.CONTAINERS[e].getElementsByClassName("walnut-image"),a=[];if(n)for(var r=0;r<n.length;r++)a.push(n[r]);if(t)for(var r=0;r<t.length;r++)a.push(t[r]);for(var s=0;s<a.length;s++){a[s].addEventListener("click",i.openViewer),a[s].setAttribute("data-walnut-index",s);var c;if(a[s].src)c=a[s].src;else{var o=a[s].currentStyle||window.getComputedStyle(a[s],!1);c=o.backgroundImage.slice(4,-1).replace(/"/g,"")}this.containerArray[e].images.push({elem:a[s],src:c,index:s})}}},buildTemplate:function(){var e=document.createElement("ul"),t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("img"),s=document.createElement("div"),c=document.createElement("div"),o=document.createElement("img"),l=document.createElement("div"),d=document.createElement("img"),v=document.createElement("img"),u=document.getElementsByTagName("body")[0],w=document.createElement("img"),m=document.createElement("div");e.className="walnut__list",t.className="walnut__list-container",r.className="walnut__image",s.className="walnut__image-container",a.className="walnut__box",n.className="walnut__wrapper",v.className="walnut__close",v.src=i.config.path+"images/button_close.svg",c.className="walnut__navigation walnut__navigation--next",o.src=i.config.path+"images/button_to_right.svg",o.className="walnut__navigation-img",l.className="walnut__navigation walnut__navigation--prev",d.src=i.config.path+"images/button_to_left.svg",d.className="walnut__navigation-img",w.className="walnut__direction-arrow",m.className="walnut__direction-line",c.appendChild(o),l.appendChild(d),m.appendChild(w),s.appendChild(r),s.appendChild(c),s.appendChild(l),s.appendChild(m),t.appendChild(e),a.appendChild(s),a.appendChild(t),a.appendChild(v),n.appendChild(a),u.appendChild(n),i.body=u,i.viewer.closeBtn=v,i.viewer.nextBtn=c,i.viewer.prevBtn=l,i.viewer.mainImage=r,i.viewer.wrapper=n,i.viewer.list=e,i.viewer.directionArrow=w,i.viewer.directionLine=m,i.viewer.box=a},setImages:function(e){var t;if(i.viewer.list.innerHTML="",this.containerArray[i.containerIndex].images.length>1){for(var n=0;n<this.containerArray[i.containerIndex].images.length;n++)t=document.createElement("li"),t.className="walnut__item",t.style.backgroundImage="url("+i.containerArray[i.containerIndex].images[n].src+")",t.setAttribute("data-walnut-source",i.containerArray[i.containerIndex].images[n].src),t.setAttribute("data-walnut-index",i.containerArray[i.containerIndex].images[n].index),t.addEventListener("click",function(){var e=this.getAttribute("data-walnut-source");i.changeImage(null,{source:e,index:this.getAttribute("data-walnut-index"),container:null})}),i.viewer.list.appendChild(t);document.getElementsByClassName("walnut__list")[0].style.width=200*this.containerArray[i.containerIndex].images.length+"px"}},openViewer:function(t){var n,a;a=e(t.target,"walnut"),a&&(i.containerIndex=a.getAttribute("data-walnut-container")),i.setImages(),n=this.getAttribute("data-walnut-index"),n=parseInt(n);var r;if(this.src)r=this.src;else{var s=this.currentStyle||window.getComputedStyle(this,!1);r=s.backgroundImage.slice(4,-1).replace(/"/g,"")}i.viewer.mainImage.src=r,i.viewer.mainImage.setAttribute("data-walnut-index",n),i.viewer.wrapper.classList.add("walnut__wrapper--open"),i.body.classList.add("walnut--open"),0===n&&n===i.containerArray[i.containerIndex].images.length-1?(i.viewer.prevBtn.style.display="none",i.viewer.nextBtn.style.display="none"):0===n?(i.viewer.prevBtn.style.display="none",i.viewer.nextBtn.style.display=""):n===i.containerArray[i.containerIndex].images.length-1?(i.viewer.nextBtn.style.display="none",i.viewer.prevBtn.style.display=""):(i.viewer.prevBtn.style.display="",i.viewer.nextBtn.style.display=""),i.initEvents(),i.checkHeight()},closeViewer:function(){i.viewer.mainImage.src="",i.viewer.wrapper.classList.remove("walnut__wrapper--open"),i.body.classList.remove("walnut--open"),i.deinitEvents()},changeImage:function(e,t){var n=0;if("undefined"!=typeof e&&null!==e){if(n=i.viewer.mainImage.getAttribute("data-walnut-index"),n=parseInt(n),"next"===e&&n<i.containerArray[i.containerIndex].images.length-1)n+=1;else{if(!("prev"===e&&n>0))return;n-=1}i.containerArray[i.containerIndex].images[n]&&(i.viewer.mainImage.src=i.containerArray[i.containerIndex].images[n].src,i.viewer.mainImage.setAttribute("data-walnut-index",n))}else"undefined"!=typeof t&&(n=parseInt(t.index),i.viewer.mainImage.src=t.source,i.viewer.mainImage.setAttribute("data-walnut-index",n));0===n&&n===i.containerArray[i.containerIndex].images.length-1?(i.viewer.prevBtn.style.display="none",i.viewer.nextBtn.style.display="none"):0===n?(i.viewer.prevBtn.style.display="none",i.viewer.nextBtn.style.display=""):n===i.containerArray[i.containerIndex].images.length-1?(i.viewer.nextBtn.style.display="none",i.viewer.prevBtn.style.display=""):(i.viewer.prevBtn.style.display="",i.viewer.nextBtn.style.display=""),i.checkHeight()},checkHeight:function(){var e=i.viewer.box.offsetHeight;e>window.innerHeight?i.viewer.wrapper.classList.add("walnut--align-top"):i.viewer.wrapper.classList.remove("walnut--align-top")},checkKeyPressed:function(e){var t=e.keyCode;37===t?i.changeImage("prev"):39===t?i.changeImage("next"):27===t&&i.closeViewer()},clickWrapper:function(e){e.stopPropagation(),e.preventDefault(),e.target===this&&i.closeViewer.call(this)},nextImage:function(){i.changeImage.call(this,"next")},prevImage:function(){i.changeImage.call(this,"prev")},swipeStart:function(e){var t=e.changedTouches[0];i.touchStartX=parseInt(t.clientX),i.touchStartY=parseInt(t.clientY),e.preventDefault()},swipeEnd:function(e){var t=e.changedTouches[0],n=parseInt(t.clientX),a=parseInt(t.clientY),r=Math.abs(a-i.touchStartY);i.touchEnd=n,e.preventDefault(),i.viewer.directionLine.classList.remove("walnut__direction-line--active"),i.viewer.directionLine.classList.remove("walnut__direction-line--active-left"),i.viewer.directionLine.classList.remove("walnut__direction-line--active-right"),i.touchStartX>i.touchEnd&&r<i.allowedTouchDistance?i.nextImage():i.touchStartX<i.touchEnd&&r<i.allowedTouchDistance&&i.prevImage()},swipeMove:function(e){var t,n,a=e.changedTouches[0],r=parseInt(a.clientX),s=parseInt(a.clientY),c=i.viewer.mainImage.getAttribute("data-walnut-index");t=Math.abs(r-i.touchStartX),n=Math.abs(s-i.touchStartY),i.viewer.directionLine.style.width=40+t+"px",i.touchStartX>r&&n<i.allowedTouchDistance&&c<i.containerArray[i.containerIndex].images.length-1?(i.viewer.directionLine.classList.remove("walnut__direction-line--active-left"),i.viewer.directionLine.classList.add("walnut__direction-line--active"),i.viewer.directionLine.classList.add("walnut__direction-line--active-right"),i.viewer.directionArrow.src=i.config.path+"images/button_to_right.svg"):i.touchStartX>r&&n<i.allowedTouchDistance?(i.viewer.directionLine.classList.remove("walnut__direction-line--active-left"),i.viewer.directionLine.classList.add("walnut__direction-line--active"),i.viewer.directionLine.classList.add("walnut__direction-line--active-right"),i.viewer.directionArrow.src=i.config.path+"images/button_close_filled.svg"):i.touchStartX<r&&n<i.allowedTouchDistance&&c>0?(i.viewer.directionLine.classList.remove("walnut__direction-line--active-right"),i.viewer.directionLine.classList.add("walnut__direction-line--active"),i.viewer.directionLine.classList.add("walnut__direction-line--active-left"),i.viewer.directionArrow.src=i.config.path+"images/button_to_left.svg"):i.touchStartX<r&&n<i.allowedTouchDistance?(i.viewer.directionLine.classList.remove("walnut__direction-line--active-right"),i.viewer.directionLine.classList.add("walnut__direction-line--active"),i.viewer.directionLine.classList.add("walnut__direction-line--active-left"),i.viewer.directionArrow.src=i.config.path+"images/button_close_filled.svg"):(i.viewer.directionLine.classList.remove("walnut__direction-line--active"),i.viewer.directionLine.classList.remove("walnut__direction-line--active-left"),i.viewer.directionLine.classList.remove("walnut__direction-line--active-right")),e.preventDefault()}};i.init()}();