"use strict";!function(){function e(e,t){for(;(e=e.parentElement)&&!e.classList.contains(t););return e}var t={init:function(){this.CONTAINERS=document.getElementsByClassName("walnut"),this.containerArray=[],this.viewer={},this.config={};var e=document.getElementById("walnutScript").src;e=e.replace("walnut.js","");for(var n=e.split("/"),a="",i=3;i<n.length;i++)3!==i&&(a+="/"),a+=n[i];t.config.path=a,this.indexImages(),this.buildTemplate(),this.addCSS()},addCSS:function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",t.config.path+"styles/walnut.css"),document.getElementsByTagName("head")[0].appendChild(e)},indexImages:function(){for(var e=0;e<this.CONTAINERS.length;e++){this.containerArray.push({container:this.CONTAINERS[e],images:[]}),this.CONTAINERS[e].setAttribute("data-walnut-container",e);var n=this.CONTAINERS[e].getElementsByTagName("img"),a=this.CONTAINERS[e].getElementsByClassName("walnut-image"),i=[];if(a)for(var r=0;r<a.length;r++)i.push(a[r]);if(n)for(var r=0;r<n.length;r++)i.push(n[r]);for(var s=0;s<i.length;s++){i[s].addEventListener("click",t.openViewer),i[s].setAttribute("data-walnut-index",s);var l;if(i[s].src)l=i[s].src;else{var c=i[s].currentStyle||window.getComputedStyle(i[s],!1);l=c.backgroundImage.slice(4,-1).replace(/"/g,"")}this.containerArray[e].images.push({elem:i[s],src:l,index:s})}}},buildTemplate:function(){var e=document.createElement("ul"),n=document.createElement("div"),a=document.createElement("div"),i=document.createElement("div"),r=document.createElement("img"),s=document.createElement("div"),l=document.createElement("div"),c=document.createElement("img"),d=document.createElement("div"),o=document.createElement("img"),m=document.createElement("img"),u=document.getElementsByTagName("body")[0];e.className="walnut__list",n.className="walnut__list-container",r.className="walnut__image",s.className="walnut__image-container",i.className="walnut__box",a.className="walnut__wrapper",m.className="walnut__close",m.src=t.config.path+"images/button_close.svg",l.className="walnut__navigation walnut__navigation--next",c.src=t.config.path+"images/button_to_right.svg",c.className="walnut__navigation-img",d.className="walnut__navigation walnut__navigation--prev",o.src=t.config.path+"images/button_to_left.svg",o.className="walnut__navigation-img",l.appendChild(c),d.appendChild(o),s.appendChild(r),s.appendChild(l),s.appendChild(d),n.appendChild(e),i.appendChild(s),i.appendChild(n),i.appendChild(m),a.appendChild(i),u.appendChild(a),t.body=u,t.viewer.closeBtn=m,t.viewer.nextBtn=l,t.viewer.prevBtn=d,t.viewer.mainImage=r,t.viewer.wrapper=a,t.viewer.list=e},setImages:function(e){var n;if(t.viewer.list.innerHTML="",this.containerArray[t.containerIndex].images.length>1){for(var a=0;a<this.containerArray[t.containerIndex].images.length;a++)n=document.createElement("li"),n.className="walnut__item",n.style.backgroundImage="url("+t.containerArray[t.containerIndex].images[a].src+")",n.setAttribute("data-walnut-source",t.containerArray[t.containerIndex].images[a].src),n.setAttribute("data-walnut-index",t.containerArray[t.containerIndex].images[a].index),n.addEventListener("click",function(){var e=this.getAttribute("data-walnut-source");t.changeImage(null,{source:e,index:this.getAttribute("data-walnut-index"),container:null})}),t.viewer.list.appendChild(n);document.getElementsByClassName("walnut__list")[0].style.width=200*this.containerArray[t.containerIndex].images.length+"px"}},openViewer:function(n){var a,i;i=e(n.target,"walnut"),i&&(t.containerIndex=i.getAttribute("data-walnut-container")),t.setImages(),a=this.getAttribute("data-walnut-index"),a=parseInt(a);var r;if(this.src)r=this.src;else{var s=this.currentStyle||window.getComputedStyle(this,!1);r=s.backgroundImage.slice(4,-1).replace(/"/g,"")}t.viewer.mainImage.src=r,t.viewer.mainImage.setAttribute("data-walnut-index",a),t.viewer.wrapper.classList.add("walnut__wrapper--open"),t.body.classList.add("walnut--open"),0===a&&a===t.containerArray[t.containerIndex].images.length-1?(t.viewer.prevBtn.style.display="none",t.viewer.nextBtn.style.display="none"):0===a?(t.viewer.prevBtn.style.display="none",t.viewer.nextBtn.style.display=""):a===t.containerArray[t.containerIndex].images.length-1?(t.viewer.nextBtn.style.display="none",t.viewer.prevBtn.style.display=""):(t.viewer.prevBtn.style.display="",t.viewer.nextBtn.style.display=""),t.initViewer()},closeViewer:function(){t.viewer.mainImage.src="",t.viewer.wrapper.classList.remove("walnut__wrapper--open"),t.body.classList.remove("walnut--open"),t.deinitViewer()},changeImage:function(e,n){var a=0;if("undefined"!=typeof e&&null!==e){if(a=t.viewer.mainImage.getAttribute("data-walnut-index"),a=parseInt(a),"next"===e&&a<t.containerArray[t.containerIndex].images.length-1)a+=1;else{if(!("prev"===e&&a>0))return;a-=1}t.containerArray[t.containerIndex].images[a]&&(t.viewer.mainImage.src=t.containerArray[t.containerIndex].images[a].src,t.viewer.mainImage.setAttribute("data-walnut-index",a))}else"undefined"!=typeof n&&(a=parseInt(n.index),t.viewer.mainImage.src=n.source,t.viewer.mainImage.setAttribute("data-walnut-index",a));0===a&&a===t.containerArray[t.containerIndex].images.length-1?(t.viewer.prevBtn.style.display="none",t.viewer.nextBtn.style.display="none"):0===a?(t.viewer.prevBtn.style.display="none",t.viewer.nextBtn.style.display=""):a===t.containerArray[t.containerIndex].images.length-1?(t.viewer.nextBtn.style.display="none",t.viewer.prevBtn.style.display=""):(t.viewer.prevBtn.style.display="",t.viewer.nextBtn.style.display="")},initViewer:function(){t.viewer.wrapper.addEventListener("click",t.clickWrapper),t.viewer.closeBtn.addEventListener("click",t.closeViewer),t.viewer.nextBtn.addEventListener("click",t.nextImage),t.viewer.prevBtn.addEventListener("click",t.prevImage),document.addEventListener("keyup",t.checkKeyPressed)},deinitViewer:function(){t.viewer.wrapper.removeEventListener("click",t.clickWrapper),t.viewer.closeBtn.removeEventListener("click",t.closeViewer),t.viewer.nextBtn.removeEventListener("click",t.nextImage),t.viewer.prevBtn.removeEventListener("click",t.prevImage),document.removeEventListener("keyup",t.checkKeyPressed)},checkKeyPressed:function(e){var n=e.keyCode;37===n?t.changeImage("prev"):39===n?t.changeImage("next"):27===n&&t.closeViewer()},clickWrapper:function(e){e.stopPropagation(),e.preventDefault(),e.target===this&&t.closeViewer.call(this)},nextImage:function(){t.changeImage.call(this,"next")},prevImage:function(){t.changeImage.call(this,"prev")}};t.init()}();